<?xml version="1.0"?>
<robot name="caffeine" xmlns:xacro="http://ros.org/wiki/xacro">
    <xacro:include filename="$(find caffeine)/urdf/inertias.xacro"/>
    <xacro:include filename="$(find caffeine)/urdf/constants.xacro"/>
    <xacro:include filename="$(find caffeine)/urdf/caffeine.gazebo.xacro"/>

    <xacro:macro name="Transmission" params="joint">
        <transmission name="trans_${joint}">
            <type>transmission_interface/SimpleTransmission</type>
            <joint name="${joint}">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
                <mechanicalReduction>1</mechanicalReduction>
            </joint>
            <actuator name="${joint}_motor">
                <hardwareInterface>hardware_interface/EffortJointInterface</hardwareInterface>
            </actuator>
        </transmission>
    </xacro:macro>

    <!-- Base link -->
    <link name="base_link">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/base_link.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/base_link.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="30"/>
            <xacro:box_inertia mass="30" length="1" width="1" height="1"/>
        </inertial>
    </link>

    <!-- Left wheel -->
    <link name="left_wheel">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/left_wheel.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/left_wheel.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="${wheel_mass}"/>
            <xacro:cylinder_inertia mass="${wheel_mass}" length="${wheel_length}" radius="${wheel_diam/2.0}"/>
        </inertial>
    </link>
    <joint name="left_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <parent link="base_link"/>
        <child link="left_wheel"/>
        <origin rpy="0 0 0" xyz="0 0.43751887 -0.61759696"/>
    </joint>
    <xacro:Transmission joint="left_wheel_joint"/>

    <!-- RIght wheel -->
    <link name="right_wheel">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/right_wheel.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/right_wheel.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="${wheel_mass}"/>
            <xacro:cylinder_inertia mass="${wheel_mass}" length="${wheel_length}" radius="${wheel_diam/2.0}"/>
        </inertial>
    </link>
    <joint name="right_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <parent link="base_link"/>
        <child link="right_wheel"/>
        <origin rpy="0 0 0" xyz="0 -0.43751887 -0.61759696"/>
    </joint>
    <xacro:Transmission joint="right_wheel_joint"/>

    <!-- Front caster wheel support -->
    <link name="front_caster">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/front_caster.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/front_caster.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="1.0"/>
            <xacro:cylinder_inertia mass="1.0" length="1.0" radius="1.0"/>
        </inertial>
    </link>
    <joint name="front_caster_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="front_caster"/>
        <origin rpy="0 0 0" xyz="0.55951056 0 -0.619167561"/>
    </joint>

    <link name="front_caster_wheel">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/front_caster_wheel.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/front_caster_wheel.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="1.0"/>
            <xacro:cylinder_inertia mass="1.0" length="1.0" radius="1.0"/>
        </inertial>
    </link>

    <joint name="front_caster_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <parent link="front_caster"/>
        <child link="front_caster_wheel"/>
        <origin rpy="0 0 0" xyz="0.03621719 0 -0.04361749"/>
    </joint>

    <!-- Back caster wheel support -->
    <link name="back_caster">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/back_caster.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/back_caster.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="1.0"/>
            <xacro:cylinder_inertia mass="1.0" length="1.0" radius="1.0"/>
        </inertial>
    </link>
    <joint name="back_caster_joint" type="continuous">
        <axis xyz="0 0 1"/>
        <parent link="base_link"/>
        <child link="back_caster"/>
        <origin rpy="0 0 0" xyz="-0.55951056 0 -0.619167561"/>
    </joint>

    <link name="back_caster_wheel">
        <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/back_caster_wheel.dae"/>
            </geometry>
        </visual>

        <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
                <mesh filename="package://caffeine/urdf/meshes/back_caster_wheel.dae"/>
            </geometry>
        </collision>

        <inertial>
            <mass value="1.0"/>
            <xacro:cylinder_inertia mass="1.0" length="1.0" radius="1.0"/>
        </inertial>
    </link>
    <joint name="back_caster_wheel_joint" type="continuous">
        <axis xyz="0 1 0"/>
        <parent link="back_caster"/>
        <child link="back_caster_wheel"/>
        <origin rpy="0 0 0" xyz="-0.03621719 0 -0.04361749"/>
    </joint>
</robot>

